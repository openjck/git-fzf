# shellcheck shell=bash
# vim: filetype=bash

COMMAND_NAME=$(basename "$0" | sed 's/git-//')

function __triggered-by-yadm() {
  PID=$1

  # We don't need to quote the PID because it will never contain whitespace
  # characters
  #
  # shellcheck disable=2086
  ps --pid $PID --no-headers --format pid,ppid,args | \
    (
      read -r PID PARENT_PID ARGS
      if grep --quiet "yadm $COMMAND_NAME" <<< "$ARGS"; then
        return 0
      else
        if [[ $PID == 1 ]]; then
          return 1
        else
          __triggered-by-yadm $PARENT_PID
        fi
      fi
    )
}

function get-client() {
  # The PID of the Bash process that is running this script. A Bash process runs
  # this script no matter what shell is being used because of the shebang.
  PARENT_PID=$$

  if __triggered-by-yadm $PARENT_PID; then
    echo "yadm"
  else
    echo "git"
  fi
}
